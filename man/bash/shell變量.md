# 學習平台
   
    服務器：192.168.5.202 賬號：名字首字母  密碼：123（如：yts / 123）
  
## 目錄  
* 	**變量的定義、賦值以及定義的格式**
* 	變量的命名規則
* 	變量的引用和顯示
* 	**腳本運行前的位置傳參**
* 	**腳本運行時的讀取參數**
* 	echo -e  字體樣式
* 	**變量的作用域**
* 	自定義方法
* 	變量的“穿透”
* 	變量的類型
* 	**字符串基本操作：截取，拼接，替換**
* 	整數型的基本運算
* 	數組類型的定義，賦值，讀取  

# shell腳本的基本作用：  
  1.自動化管理重要依據  
  2.追踪與管理系統的重要工作  

# 定義變量以及變量的基本使用案例  
  **1.定义变量的语法**  
    定义变量时，变量名和变量值之间使用“=”分隔，并且等号两边不能有空格， 如：
	
	变量名=变量值	
  
  **2.变量名规则**  
    变量名的定义必须遵循以下规则：  

    1 命名只能使用英文字母，数字和下划线，首个字符不能以数字开头。  
    2 中间不能有空格，可以使用下划线。  
    3 不能使用标点符号。  
    4 不能使用bash里的关键字。  


  **3.使用变量**  
    使用一个定义过的变量，只要在变量名前面加美元符号即可，建议将变量名使用 {} 括起来之后再添加美元符号：  

    echo ${name}  或者$name

 **4 修改变量为只读（可理解為常量）**    
    使用readonly命令可以将变量定义为只读变量，只读变量的值不能被改变，也不能被删除：  

       readonly VAL
       readonly val
       readonly Val

**5 删除变量**  
    使用unset命令可以删除变量，但不能删除只读变量：  

    unset name

**6 位置参数**  
	运行Shell脚本文件时我们可以给它传递一些参数，这些参数在脚本文件内部可以使用 $n 的形式来接收。  
	例如： $1 表示第一个参数， $2 表示第二个参数，依次类推。  
	如果参数个数达到或者超过了10个，那么就得用 ${n} 的形式来接收了.  
	例如： ${10} 、 ${23} 。  
	 {} 的作用是为了帮助解释器识别参数的边界，这跟使用变量时加 {} 是一样的效果。 
     
**`test.sh`脚本内容：**  

	1 #!/bin/bash
	2 echo "第一个参数 : $1"
	3 echo "第二个参数 : $2"

**脚本调用：**  

 	[root@localhost ~]# sh test.sh A B

**执行结果：**  
	1 第一个参数 : A   
	2 第二个参数 : B  

**通過實時操控輸入參數：**  

	read -p "輸入提示"  value1
	read -p "輸入提示"  value2
	echo -e "\n\n Your input is \033[31m $value1 \033[31m  \033[36m $value2 \033[0m"

**`echo -e`字体色范围：30-37**  

	echo -e "\033[30m 黑色字 \033[0m"
	echo -e "\033[31m 红色字 \033[0m"
	echo -e "\033[32m 绿色字 \033[0m"
	echo -e "\033[33m 黄色字 \033[0m"
	echo -e "\033[34m 蓝色字 \033[0m"
	echo -e "\033[35m 紫色字 \033[0m"
	echo -e "\033[36m 天蓝字 \033[0m"
	echo -e "\033[37m 白色字 \033[0m"

**`echo -e`字背景颜色范围：40-47**  

	echo -e "\033[40;37m 黑底白字 \033[0m"
	echo -e "\033[41;30m 红底黑字 \033[0m"
	echo -e "\033[42;34m 绿底蓝字 \033[0m"
	echo -e "\033[43;34m 黄底蓝字 \033[0m"
	echo -e "\033[44;30m 蓝底黑字 \033[0m"
	echo -e "\033[45;30m 紫底黑字 \033[0m"
	echo -e "\033[46;30m 天蓝底黑字 \033[0m"
	echo -e "\033[47;34m 白底蓝字 \033[0m"  

**`echo -e`控制选项说明**  

	echo -e "\033[0m 关闭所有属性"  
	echo -e "\033[1m 设置高亮度 "  
	echo -e "\033[4m 下划线 "  

	echo -e "\033[4;31m 下划线红字 \033[0m"	  
	echo -e "\033[5;34m 蓝字在闪烁 \033[0m"
	echo -e "\033[8m 消隐 \033[0m "

	echo -e "\033[30m-\033[37m 设置前景色 "  
	echo -e "\033[40m-\033[47m 设置背景色 "  
	echo -e "\033[nA光标上移n行 "  
	echo -e "\033[nB光标下移n行 "  

	echo -e "\033[4A 光标上移4行 \033[0m"

	echo -e "\033[nC光标右移n行 "  
	echo -e "\033[nD光标左移n行 "  
	echo -e "\033[y;xH设置光标位置 "  
	echo -e "\033[2J清屏 "  
	echo -e "\033[K清除从光标到行尾的内容 "  

	echo -e "\033[K 清除光标到行尾的内容 \033[0m"

	echo -e "\033[s 保存光标位置 "  
	echo -e "\033[u 恢复光标位置 "  
	echo -e "\033[?25| 隐藏光标 "  
	echo -e "\033[?25h 显示光标 "  

	echo -e "\033[?25l 隐藏光标 \033[0m"
	echo -e "\033[?25h 显示光标 \033[0m"


**`echo -e`字體特效可以叠加，但需要使用“;”隔开，例如：闪烁+下划线+白底色+黑字为   \033[5;4;47;30m闪烁+下划线+白底色+黑字为\033[0m**  

####  掌握:
    1、參數從外部進入shell內部，並且保存和使用
    2、重要操作或者說明，使用文字特殊樣式的提醒
## 變量的作用域  

	**全局變量/局部變量**

### shell可以自定方法（能更有效體現全局和局部的區別）  
**自定方法案例：**  
```
function test(){
        name="yts";
        echo $name;
}
```

**全局變量：**  

```
function test(){
        name="yts";
}
echo $name;	#沒結果
test;		#運行方法
echo $name;	#輸出『yts』
```

###  使用local 定義局部變量  

```
function test(){
       local   name="yts";
       echo 'test(): '"$name";	               #輸出  『  test(): yts   』
}
echo $name;	#沒結果
test;		#運行方法
echo $name;	#沒結果
```

PS:如果沒有使用local聲明，所定義的變量可以在本腳本的任意地方使用

Q：全局變量，是不是就可以在任意地方可以使用了呢？ 
A：是，也不是，因為需要用到source等命令進行引用（類似 `this` 、 `super`）。

###  Shell 全局变量

	所谓全局变量，就是指变量在当前的整个 `Shell 进程`  中都有效。
	每个 Shell 进程都有自己的當前shell作用域，彼此之间互不影响。

	全局变量的作用范围是当前的 Shell 进程，而不是当前的 Shell 脚本文件。
	在一个 Shell 进程中可以使用 source 命令执行多个 Shell 脚本文件，此时全局变量在这些脚本文件中都有效。

**變量“穿透”案例**  

```
shell定義：
a="I am a"
```
`shellVar1.sh:`  
```
echo $a;
b="I am b"
```    
`shellVar2.sh:`  
```
echo $b
```
`#shell中運行 (不穿透) ：`  
```
echo $a			        #輸出  I am a
./shellVar1.sh   	#沒有輸出  原因是啟用了新的線程
./shellVar2.sh		#沒有輸出  同上
```

`#shell中運行 （穿透） ：`  
```
echo $a			        #輸出  I am a
source ./shellVar1.sh   	#輸出  I am a
source ./shellVar2.sh		#輸出  I am b
```
PS:source命令是指在本shell線程中執行腳本。 如果有需要，可通過echo $$來查看線程  

PPS：可以讓兩個腳本之間進行數據互通。
  
**案例1（通過echo $$來查看線程）**  
```
echo $$
shellVar1.sh:

echo $$
echo $a;
b="I am b"

shellVar2.sh:

echo $$
echo $b
```

**案例2:補充shellVar.sh（shell開啟一個腳本進行變量的穿透）**  

```
echo $$
echo '$a:       '"$a"
echo '$b:       '"$b"
source ./shellVar1.sh
source ./shellVar2.sh
```
####  PS
```
环境级变量只在当前 shell 中生效, shell 关闭变量丢失
用户级变量写在用户的骨文件(.bash_profile)中,只针对当前用户生效,切换用户后就不再生效
系统级变量被写在系统的配置文件 /etc/profile 或者 /etc/profile.d/ 中,对于所有用户都生效
```
##  数据类型  

###  字符串
	字符串是shell编程中最常用最有用的数据类型，字符串可以用单引号，也可以用双引号，也可以不用引号。  
	建议使用双引号，因为双引号里可以有变量和特殊字符，可以按照变量和特殊字符去使用。  

**声明字符串类型的变量：**  

	name="Sam"

**截取字符串1**  
```
value="0123456789";
result=`expr substr "$value" 3 2`;
echo $result
```
PS:substr 無法識別中文  
**截取字符串2**  
```
value="0123456789";
result=`echo ${value}|cut -c 2-3`
echo $result
```
**截取字符串3**   
```
value="0讓生命1變得更加1有意義"
echo  "--------------";
echo "$value:";
result='${value##*1}:   '${value##*1}
echo $result
result='${value#*1}:    '${value#*1}
echo $result
```
**結果：**   
```
0讓生命1變得更加1有意義:
${value##*1}: 有意義
${value#*1}: 變得更加1有意義
```

**拼接字符串：**  

	hello="hello, $name !"
**字符串替換**  
```
${变量/查找/替换值}  一个'/'表示替换第一个'//'表示替换所有，当查找出中出现了："/"需要转移成"\/"
```
**案例1：將passwd裡面的所有『：』替換為『-』;**  
```
content=`cat ./passwd`
content=${content//:/-}
echo  $content

```
**案例2：將passwd裡面的所有『：』替換為『-』**  
```
echo "" > ./passwd.R
exec < ./passwd
while read line
do
        echo ${line//:/ } >> ./passwd.R
done
```
ps:exec <file  将file中的内容作为exec的标准输入



###  整数型  
	在Shell中所有的变量默认都是字符串型。也就是说，如果不手工指定变量的类型，那么所有的数值都是不能进行运算的：

 	a=1
	b=2
 	c=$a+$b
	echo $c

**結果：**  

	1+2

**如果想要进行数学运算，可以使用“$((运算式))”或“$[运算式]”方式运算：**  

	echo $(($a+$b))
	echo $[$a+$b]

###  数组  
	bash支持一维数组（不支持多维数组），并且没有限定数组的大小。用括号来表示数组，数组元素用空格符号分割开。
	定义数组的一般形式为：
	数组元素的下标由0开始编号。获取数组中的元素要利用下标，下标可以是整数或算术表达式，其值应大于或等于0。
	
**声明数组类型的变量：**  
 	数组名=(值1 值2 ... 值n)

**也可以通过指定下标来声明：**  
	数组名[下标]=值

**获取数组指定下标的值：**  
	${数组名[下标]}

**使用“@”符号可以获取数组中的所有元素：**  
	${数组名[@]}

## 重點回顧：
```
	變量的定義、賦值以及定義的格式
	變量的命名規則
	變量的引用和顯示
	
	腳本運行前的位置傳參
	腳本運行時的讀取參數
	
	echo -e  字體樣式
	
	變量的作用域
	自定義方法
	變量的“穿透”

	變量的類型
	字符串基本操作：截取，拼接，替換
	整數型的基本運算
	數組類型的定義，賦值，讀取
```

**練習/作業**  

1. 定义一变量（常量），保存本地域名。
1. 定义一个變量，保存twant待测试的服务器。
1. 定义一个数组，保存本地twant所有待测试的网页链接情况
* 输出使用curl对本地域名的测试结果
* 输出使用curl对twant所有服务器的测试结果
* 输出使用curl网页链接测试的结果

####  練習參考腳本：  

	clear
	echo "已調用hostname命令獲取到本地域名：";
	readonly HOSTNAME=`hostname`;
	echo "本地域名為：${HOSTNAME}";
	echo -e "\033[31m------------分割線-------------\033[0m";
	read -p "輸入任意內容進入下一步" 
	echo "curl本地域名，並輸出結果";
	testResult=`curl ${HOSTNAME}`；
	echo "===測試結果
	$testResult";
	echo -e "\033[31m------------分割線-------------\033[0m";
	read -p "輸入任意內容進入下一步" 
	clear
	echo "本次測試待測服務器為：192.168.6.203:8081"
	IP="192.168.6.203:8081"
	echo "192.168.6.203:8081測試：";
	testResult=`curl ${IP}`;
	echo "===測試結果
	$testResult";
	echo -e "\033[31m------------分割線-------------\033[0m";
	read -p "輸入任意內容進入下一步" 
	clear
	webPage[0]="curl -X POST -i  http://192.168.6.203:8081/api";
	webPage[1]="curl -X POST -i  http://192.168.6.203:8081/api/getAllNavigationTypeTags";
	
	echo "API接口頁面測試：";
	testResult=`curl ${webPage[0]}`;
	echo "===測試結果
	$testResult";
	echo -e "\033[31m------------分割線-------------\033[0m";
	read -p "輸入任意內容進入下一步" 
	clear
	echo "獲取所有導航標籤測試：";
	testResult=`curl ${webPage[1]}`;
	echo "===測試結果
	$testResult";
	echo -e "\033[31m------------分割線-------------\033[0m";
	read -p "輸入任意內容進入下一步" 
	clear
	echo "---------------------end-----------------"

####  PS：
	
	新增一台网站运行情况监听服务器，
	将要测试的『屬性』写入脚本保存起來。
	學會流程語句以及相關的處理命令後，
	(try)一旦監聽到可識別的故障，
	(catch)進行對應的異常進行處理。
	(finally)並最終對處理結果反饋到相關聯繫人手中。

